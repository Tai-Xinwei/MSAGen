<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sfm.utils package &mdash; A4SFramework ai4science documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c1325062"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sfm.utils.optim package" href="sfm.utils.optim.html" />
    <link rel="prev" title="sfm.tasks.tamgent package" href="sfm.tasks.tamgent.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >



          <a href="../index.html" class="icon icon-home">
            A4SFramework
          </a>
              <div class="version">
                0.0.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userfriendly.html">User-friendly Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.html">Large Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelzoo.html">Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datapipeline.html">Data Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trainargs.html">Training Args</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">sfm</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="sfm.html">sfm package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="sfm.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="sfm.criterions.html">sfm.criterions package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.data.html">sfm.data package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.logging.html">sfm.logging package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.models.html">sfm.models package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.modules.html">sfm.modules package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.pipeline.html">sfm.pipeline package</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.tasks.html">sfm.tasks package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">sfm.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sfm.html#module-sfm">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">A4SFramework</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">sfm</a></li>
          <li class="breadcrumb-item"><a href="sfm.html">sfm package</a></li>
      <li class="breadcrumb-item active">sfm.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/sfm.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="sfm-utils-package">
<h1>sfm.utils package<a class="headerlink" href="#sfm-utils-package" title="Link to this heading"></a></h1>
<section id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="sfm.utils.optim.html">sfm.utils.optim package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sfm.utils.optim.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfm.utils.optim.html#module-sfm.utils.optim.adam">sfm.utils.optim.adam module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.adam.AdamW"><code class="docutils literal notranslate"><span class="pre">AdamW</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.adam.AdamW.step"><code class="docutils literal notranslate"><span class="pre">AdamW.step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.adam.AdamW.supports_flat_params"><code class="docutils literal notranslate"><span class="pre">AdamW.supports_flat_params</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.adam.AdamW.supports_memory_efficient_fp16"><code class="docutils literal notranslate"><span class="pre">AdamW.supports_memory_efficient_fp16</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sfm.utils.optim.html#module-sfm.utils.optim.optimizer">sfm.utils.optim.optimizer module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.optimizer.myAdam"><code class="docutils literal notranslate"><span class="pre">myAdam()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.optimizer.process_param"><code class="docutils literal notranslate"><span class="pre">process_param()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.optimizer.split_param_and_layer_name"><code class="docutils literal notranslate"><span class="pre">split_param_and_layer_name()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sfm.utils.optim.html#module-sfm.utils.optim.set_lr">sfm.utils.optim.set_lr module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.groupWarmupDecayLR"><code class="docutils literal notranslate"><span class="pre">groupWarmupDecayLR</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.groupWarmupDecayLR.step"><code class="docutils literal notranslate"><span class="pre">groupWarmupDecayLR.step()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.group_param"><code class="docutils literal notranslate"><span class="pre">group_param()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.group_param_copilot"><code class="docutils literal notranslate"><span class="pre">group_param_copilot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.myAdam"><code class="docutils literal notranslate"><span class="pre">myAdam()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.myGroupAdam"><code class="docutils literal notranslate"><span class="pre">myGroupAdam()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.myMuAdam"><code class="docutils literal notranslate"><span class="pre">myMuAdam()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.process_freeze_param"><code class="docutils literal notranslate"><span class="pre">process_freeze_param()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="sfm.utils.optim.html#sfm.utils.optim.set_lr.process_param_groups"><code class="docutils literal notranslate"><span class="pre">process_param_groups()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sfm.utils.optim.html#module-sfm.utils.optim">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-sfm.utils.FairseqDataset">
<span id="sfm-utils-fairseqdataset-module"></span><h2>sfm.utils.FairseqDataset module<a class="headerlink" href="#module-sfm.utils.FairseqDataset" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.EpochListening">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.FairseqDataset.</span></span><span class="sig-name descname"><span class="pre">EpochListening</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.EpochListening" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Mixin for receiving updates whenever the epoch increments.</p>
<dl class="py property">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.EpochListening.can_reuse_epoch_itr_across_epochs">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">can_reuse_epoch_itr_across_epochs</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.EpochListening.can_reuse_epoch_itr_across_epochs" title="Link to this definition"></a></dt>
<dd><p>Whether we can reuse the <code class="xref py py-class docutils literal notranslate"><span class="pre">fairseq.data.EpochBatchIterator</span></code> for
this dataset across epochs.
This needs to return <code class="docutils literal notranslate"><span class="pre">False</span></code> if the sample sizes can change across
epochs, in which case we may need to regenerate batches at each epoch.
If your dataset relies in <code class="docutils literal notranslate"><span class="pre">set_epoch</span></code> then you should consider setting
this to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.EpochListening.set_epoch">
<span class="sig-name descname"><span class="pre">set_epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.EpochListening.set_epoch" title="Link to this definition"></a></dt>
<dd><p>Will receive the updated epoch number at the beginning of the epoch.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.FairseqDataset.</span></span><span class="sig-name descname"><span class="pre">FairseqDataset</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code>, <a class="reference internal" href="#sfm.utils.FairseqDataset.EpochListening" title="sfm.utils.FairseqDataset.EpochListening"><code class="xref py py-class docutils literal notranslate"><span class="pre">EpochListening</span></code></a></p>
<p>A dataset that provides helpers for batching.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.attr">
<span class="sig-name descname"><span class="pre">attr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.attr" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.batch_by_size">
<span class="sig-name descname"><span class="pre">batch_by_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sentences</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_batch_size_multiple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.batch_by_size" title="Link to this definition"></a></dt>
<dd><p>Given an ordered set of indices, return batches according to
<em>max_tokens</em>, <em>max_sentences</em> and <em>required_batch_size_multiple</em>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.collate_tokens">
<span class="sig-name descname"><span class="pre">collate_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eos_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left_pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">move_eos_to_beginning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_to_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_to_multiple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_to_bsz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.collate_tokens" title="Link to this definition"></a></dt>
<dd><p>Convert a list of 1d tensors into a padded 2d tensor.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.collater">
<span class="sig-name descname"><span class="pre">collater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">samples</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.collater" title="Link to this definition"></a></dt>
<dd><p>Merge a list of samples to form a mini-batch.
Args:</p>
<blockquote>
<div><p>samples (List[dict]): samples to collate</p>
</div></blockquote>
<dl class="simple">
<dt>Returns:</dt><dd><p>dict: a mini-batch suitable for forwarding with a Model</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.filter_indices_by_size">
<span class="sig-name descname"><span class="pre">filter_indices_by_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sizes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.filter_indices_by_size" title="Link to this definition"></a></dt>
<dd><p>Filter a list of sample indices. Remove those that are longer than
specified in <em>max_sizes</em>.
WARNING: don’t update, override method in child classes
Args:</p>
<blockquote>
<div><p>indices (np.array): original array of sample indices
max_sizes (int or list[int] or tuple[int]): max sample size,</p>
<blockquote>
<div><p>can be defined separately for src and tgt (then list or tuple)</p>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>Returns:</dt><dd><p>np.array: filtered sample array
list: list of removed indices</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.get_batch_shapes">
<span class="sig-name descname"><span class="pre">get_batch_shapes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.get_batch_shapes" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Return a list of valid batch shapes, for example::</dt><dd><p>[(8, 512), (16, 256), (32, 128)]</p>
</dd>
</dl>
<p>The first dimension of each tuple is the batch size and can be <code class="docutils literal notranslate"><span class="pre">None</span></code>
to automatically infer the max batch size based on <code class="docutils literal notranslate"><span class="pre">--max-tokens</span></code>.
The second dimension of each tuple is the max supported length as given
by <code class="xref py py-func docutils literal notranslate"><span class="pre">fairseq.data.FairseqDataset.num_tokens()</span></code>.
This will be used by <code class="xref py py-func docutils literal notranslate"><span class="pre">fairseq.data.FairseqDataset.batch_by_size()</span></code>
to restrict batch shapes. This is useful on TPUs to avoid too many
dynamic shapes (and recompilations).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.num_tokens">
<span class="sig-name descname"><span class="pre">num_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.num_tokens" title="Link to this definition"></a></dt>
<dd><p>Return the number of tokens in a sample. This value is used to
enforce <code class="docutils literal notranslate"><span class="pre">--max-tokens</span></code> during batching.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.num_tokens_vec">
<span class="sig-name descname"><span class="pre">num_tokens_vec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.num_tokens_vec" title="Link to this definition"></a></dt>
<dd><p>Return the number of tokens for a set of positions defined by indices.
This value is used to enforce <code class="docutils literal notranslate"><span class="pre">--max-tokens</span></code> during batching.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.ordered_indices">
<span class="sig-name descname"><span class="pre">ordered_indices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.ordered_indices" title="Link to this definition"></a></dt>
<dd><p>Return an ordered list of indices. Batches will be constructed based
on this order.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.prefetch">
<span class="sig-name descname"><span class="pre">prefetch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.prefetch" title="Link to this definition"></a></dt>
<dd><p>Prefetch the data required for this epoch.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.size">
<span class="sig-name descname"><span class="pre">size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.size" title="Link to this definition"></a></dt>
<dd><p>Return an example’s size as a float or tuple. This value is used when
filtering a dataset with <code class="docutils literal notranslate"><span class="pre">--max-positions</span></code>.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.supports_fetch_outside_dataloader">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">supports_fetch_outside_dataloader</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.supports_fetch_outside_dataloader" title="Link to this definition"></a></dt>
<dd><p>Whether this dataset supports fetching outside the workers of the dataloader.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqDataset.supports_prefetch">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">supports_prefetch</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqDataset.supports_prefetch" title="Link to this definition"></a></dt>
<dd><p>Whether this dataset supports prefetching.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.FairseqDataset.FairseqIterableDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.FairseqDataset.</span></span><span class="sig-name descname"><span class="pre">FairseqIterableDataset</span></span><a class="headerlink" href="#sfm.utils.FairseqDataset.FairseqIterableDataset" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">IterableDataset</span></code>, <a class="reference internal" href="#sfm.utils.FairseqDataset.EpochListening" title="sfm.utils.FairseqDataset.EpochListening"><code class="xref py py-class docutils literal notranslate"><span class="pre">EpochListening</span></code></a></p>
<p>For datasets that need to be read sequentially, usually because the data is
being streamed or otherwise can’t be manipulated on a single machine.</p>
</dd></dl>

</section>
<section id="module-sfm.utils.LayerDropModuleList">
<span id="sfm-utils-layerdropmodulelist-module"></span><h2>sfm.utils.LayerDropModuleList module<a class="headerlink" href="#module-sfm.utils.LayerDropModuleList" title="Link to this heading"></a></h2>
<p>LayerDrop as described in <a class="reference external" href="https://arxiv.org/abs/1909.11556">https://arxiv.org/abs/1909.11556</a>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.LayerDropModuleList.LayerDropModuleList">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.LayerDropModuleList.</span></span><span class="sig-name descname"><span class="pre">LayerDropModuleList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.LayerDropModuleList.LayerDropModuleList" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ModuleList</span></code></p>
<p>A LayerDrop implementation based on <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code>.</p>
<p>We refresh the choice of which layers to drop every time we iterate
over the LayerDropModuleList instance. During evaluation we always
iterate over all layers.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="n">LayerDropList</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="n">layer1</span><span class="p">,</span> <span class="n">layer2</span><span class="p">,</span> <span class="n">layer3</span><span class="p">])</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>  <span class="c1"># this might iterate over layers 1 and 3</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>  <span class="c1"># this might iterate over all layers</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>  <span class="c1"># this might not iterate over any layers</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>p (float): probability of dropping out each layer
modules (iterable, optional): an iterable of modules to add</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-sfm.utils.PPEngine">
<span id="sfm-utils-ppengine-module"></span><h2>sfm.utils.PPEngine module<a class="headerlink" href="#module-sfm.utils.PPEngine" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.PPEngine.</span></span><span class="sig-name descname"><span class="pre">SFMPipeEngine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_bool_tensors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_ckpt_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copilot_train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repeat_dataloader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">super_args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">super_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">DeepSpeedEngine</span></code></p>
<p>A training engine hybrid pipeline, data, and model parallel training.</p>
<p>This engine is created by <code class="docutils literal notranslate"><span class="pre">deepspeed.initialize()</span></code> when a <code class="xref py py-class docutils literal notranslate"><span class="pre">PipelineModule</span></code>
is provided.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.DTYPE_TO_ID">
<span class="sig-name descname"><span class="pre">DTYPE_TO_ID</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{torch.bfloat16:</span> <span class="pre">5,</span> <span class="pre">torch.bool:</span> <span class="pre">11,</span> <span class="pre">torch.complex128:</span> <span class="pre">3,</span> <span class="pre">torch.complex64:</span> <span class="pre">2,</span> <span class="pre">torch.float16:</span> <span class="pre">4,</span> <span class="pre">torch.float32:</span> <span class="pre">0,</span> <span class="pre">torch.float64:</span> <span class="pre">1,</span> <span class="pre">torch.int16:</span> <span class="pre">8,</span> <span class="pre">torch.int32:</span> <span class="pre">9,</span> <span class="pre">torch.int64:</span> <span class="pre">10,</span> <span class="pre">torch.int8:</span> <span class="pre">7,</span> <span class="pre">torch.uint8:</span> <span class="pre">6}</span></em><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.DTYPE_TO_ID" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.ID_TO_DTYPE">
<span class="sig-name descname"><span class="pre">ID_TO_DTYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[torch.float32,</span> <span class="pre">torch.float64,</span> <span class="pre">torch.complex64,</span> <span class="pre">torch.complex128,</span> <span class="pre">torch.float16,</span> <span class="pre">torch.bfloat16,</span> <span class="pre">torch.uint8,</span> <span class="pre">torch.int8,</span> <span class="pre">torch.int16,</span> <span class="pre">torch.int32,</span> <span class="pre">torch.int64,</span> <span class="pre">torch.bool]</span></em><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.ID_TO_DTYPE" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.allreduce_gradients">
<span class="sig-name descname"><span class="pre">allreduce_gradients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.allreduce_gradients" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.backward">
<span class="sig-name descname"><span class="pre">backward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.backward" title="Link to this definition"></a></dt>
<dd><p>Disabled for pipeline parallel training. See <code class="docutils literal notranslate"><span class="pre">train_batch()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.eval_batch">
<span class="sig-name descname"><span class="pre">eval_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_iter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_logits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'avg'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.eval_batch" title="Link to this definition"></a></dt>
<dd><p>Evaluate the pipeline on a batch of data from <code class="docutils literal notranslate"><span class="pre">data_iter</span></code>. The
engine will evaluate <code class="docutils literal notranslate"><span class="pre">self.train_batch_size()</span></code> total samples
collectively across all workers.</p>
<p>This method is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">module</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">module</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A total of <code class="docutils literal notranslate"><span class="pre">self.gradient_accumulation_steps()</span></code> entries will be pulled
from <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> by each pipeline. There must be sufficient
data left in <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> or else a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> will halt training.</p>
<p>DeepSpeed provides a convenience class <code class="xref py py-class docutils literal notranslate"><span class="pre">deepspeed.utils.RepeatingLoader</span></code>
that wraps data loaders to automatically restart upon a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code>.</p>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>data_iter (Iterator): Iterator of data to evaluate.</p>
</dd>
<dt>Returns:</dt><dd><p>The arithmetic mean of the losses computed this batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.fast_load_checkpoint">
<span class="sig-name descname"><span class="pre">fast_load_checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.fast_load_checkpoint" title="Link to this definition"></a></dt>
<dd><p>Load training checkpoint</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.forward" title="Link to this definition"></a></dt>
<dd><p>Disabled for pipeline parallel training. See <code class="docutils literal notranslate"><span class="pre">train_batch()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.is_first_stage">
<span class="sig-name descname"><span class="pre">is_first_stage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.is_first_stage" title="Link to this definition"></a></dt>
<dd><p>True if this process is in the first stage in the pipeline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.is_gradient_accumulation_boundary">
<span class="sig-name descname"><span class="pre">is_gradient_accumulation_boundary</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.is_gradient_accumulation_boundary" title="Link to this definition"></a></dt>
<dd><p>True if the engine is executing a gradient reduction or optimizer step instruction.</p>
<p>This is overridden from <code class="xref py py-class docutils literal notranslate"><span class="pre">DeepSpeedEngine</span></code> to force reductions
and steps when the pipeline engine is instructed to do so.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>bool: whether reductions and optimizer steps should occur.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.is_last_stage">
<span class="sig-name descname"><span class="pre">is_last_stage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.is_last_stage" title="Link to this definition"></a></dt>
<dd><p>True if this process is in the last stage in the pipeline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.load_checkpoint">
<span class="sig-name descname"><span class="pre">load_checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">load_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_module_strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_optimizer_states</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_lr_scheduler_states</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_module_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_load_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.load_checkpoint" title="Link to this definition"></a></dt>
<dd><p>Load training checkpoint
Arguments:</p>
<blockquote>
<div><p>load_dir: Required. Directory to load the checkpoint from
tag: Checkpoint tag used as a unique identifier for checkpoint, if not provided will attempt to load tag in ‘latest’ file
load_module_strict: Optional. Boolean to strictly enforce that the keys in state_dict of module and checkpoint match.
load_optimizer_states: Optional. Boolean to load the training optimizer states from Checkpoint. Ex. ADAM’s momentum and variance
load_lr_scheduler_states: Optional. Boolean to add the learning rate scheduler states from Checkpoint.
load_module_only: Optional. Boolean to load only the model weights from the checkpoint. Ex. warmstarting.
custom_load_fn: Optional. Custom model load function.</p>
</div></blockquote>
<dl class="simple">
<dt>Returns:</dt><dd><p>A tuple of <code class="docutils literal notranslate"><span class="pre">load_path</span></code> and <code class="docutils literal notranslate"><span class="pre">client_state</span></code>.
<a href="#id1"><span class="problematic" id="id2">*</span></a><code class="docutils literal notranslate"><span class="pre">load_path</span></code>: Path of the loaded checkpoint. <code class="docutils literal notranslate"><span class="pre">None</span></code> if loading the checkpoint failed.
<a href="#id3"><span class="problematic" id="id4">*</span></a><code class="docutils literal notranslate"><span class="pre">client_state</span></code>: State dictionary used for loading required training states in the client code.</p>
</dd>
</dl>
<p>Important: under ZeRO3, one cannot load checkpoint with <code class="docutils literal notranslate"><span class="pre">engine.load_checkpoint()</span></code> right
after <code class="docutils literal notranslate"><span class="pre">engine.save_checkpoint()</span></code>. It is because <code class="docutils literal notranslate"><span class="pre">engine.module</span></code> is partitioned, and
<code class="docutils literal notranslate"><span class="pre">load_checkpoint()</span></code> wants a pristine model. If insisting to do so, please reinitialize engine
before <code class="docutils literal notranslate"><span class="pre">load_checkpoint()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.load_module_state_dict">
<span class="sig-name descname"><span class="pre">load_module_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_load_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.load_module_state_dict" title="Link to this definition"></a></dt>
<dd><p>Override hack to instead use a directory path.</p>
<p>This is important because pipeline models checkpoint by layer instead of rank.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">state_dict</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code> or a <code class="docutils literal notranslate"><span class="pre">str</span></code>, we revert to <code class="docutils literal notranslate"><span class="pre">super()</span></code> expecting a <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>state_dict (str, None): unused
strict (bool, optional): Strict state loading. Defaults to True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.log_for_device">
<span class="sig-name descname"><span class="pre">log_for_device</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.log_for_device" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.mem_status">
<span class="sig-name descname"><span class="pre">mem_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">print_rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reset_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.mem_status" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.module_state_dict">
<span class="sig-name descname"><span class="pre">module_state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.module_state_dict" title="Link to this definition"></a></dt>
<dd><p>Override hack to save a pipe model and return the directory path of the save.</p>
<p>This method should only be called by DeepSpeed’s <code class="docutils literal notranslate"><span class="pre">save_checkpoint()</span></code>. The
recommended way of saving a <code class="docutils literal notranslate"><span class="pre">PipelineModule</span></code> outside of <code class="docutils literal notranslate"><span class="pre">save_checkpoint()</span></code>
is <code class="docutils literal notranslate"><span class="pre">save_state_dict()</span></code>.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.reset_activation_shape">
<span class="sig-name descname"><span class="pre">reset_activation_shape</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.reset_activation_shape" title="Link to this definition"></a></dt>
<dd><p>Reset the buffers when the shape of activation and gradient change.
For example, for curriculum learning that changes the seqlen of each
sample, we need to call this whenever the seqlen is going to change.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.set_batch_fn">
<span class="sig-name descname"><span class="pre">set_batch_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.set_batch_fn" title="Link to this definition"></a></dt>
<dd><p>Execute a post-processing function on input data.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>fn (function): The function to run.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.set_dataiterator">
<span class="sig-name descname"><span class="pre">set_dataiterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterator</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.set_dataiterator" title="Link to this definition"></a></dt>
<dd><p>Store an iterator to sample for training data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.set_dataloader">
<span class="sig-name descname"><span class="pre">set_dataloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.set_dataloader" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.set_has_attention_mask">
<span class="sig-name descname"><span class="pre">set_has_attention_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.set_has_attention_mask" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.set_train_batch_size">
<span class="sig-name descname"><span class="pre">set_train_batch_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_batch_size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.set_train_batch_size" title="Link to this definition"></a></dt>
<dd><p>Adjust the global batch size by increasing or decreasing the number of
micro-batches (i.e., gradient accumulation steps). The size of each micro-batch
(i.e., <code class="docutils literal notranslate"><span class="pre">train_micro_batch_size_per_gpu</span></code>) is not changed.
Args:</p>
<blockquote>
<div><p>train_batch_size (int): The new global batch size for training.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.step" title="Link to this definition"></a></dt>
<dd><p>Disabled for pipeline parallel training. See <code class="docutils literal notranslate"><span class="pre">train_batch()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.tput_log">
<span class="sig-name descname"><span class="pre">tput_log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.tput_log" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.train_batch">
<span class="sig-name descname"><span class="pre">train_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.train_batch" title="Link to this definition"></a></dt>
<dd><p>Progress the pipeline to train the next batch of data. The engine will ingest
<code class="docutils literal notranslate"><span class="pre">self.train_batch_size()</span></code> total samples collectively across all workers.</p>
<p>An iterator that over training data should be provided as an argument
unless <code class="docutils literal notranslate"><span class="pre">deepspeed.initialize()</span></code> was provided a training set. In that event,
the training data will automatically be read.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A total of <code class="docutils literal notranslate"><span class="pre">self.gradient_accumulation_steps()</span></code> entries will be pulled
from <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> by each pipeline. There must be sufficient
data left in <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> or else a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> will halt training.</p>
<p>DeepSpeed provides a convenience class <code class="xref py py-class docutils literal notranslate"><span class="pre">deepspeed.utils.RepeatingLoader</span></code>
that wraps data loaders to automatically restart upon a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code>.</p>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>data_iter (Iterator, optional): Iterator of training data.</p>
</dd>
<dt>Returns:</dt><dd><p>The arithmetic mean of the losses computed this batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.SFMPipeEngine.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sfm.utils.PPEngine.SFMPipeEngine.training" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.initialize">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.PPEngine.</span></span><span class="sig-name descname"><span class="pre">initialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optimizer</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Parameter</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optimizer</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_LRScheduler</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Optimizer</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_LRScheduler</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_init_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collate_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_ckpt_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copilot_train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repeat_dataloader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.initialize" title="Link to this definition"></a></dt>
<dd><p>Initialize the DeepSpeed Engine.</p>
<dl>
<dt>Arguments:</dt><dd><dl class="simple">
<dt>args: an object containing local_rank and deepspeed_config fields.</dt><dd><p>This is optional if <cite>config</cite> is passed.</p>
</dd>
</dl>
<p>model: Required: nn.module class before apply any wrappers</p>
<dl class="simple">
<dt>optimizer: Optional: a user defined Optimizer or Callable that returns an Optimizer object.</dt><dd><p>This overrides any optimizer definition in the DeepSpeed json config.</p>
</dd>
<dt>model_parameters: Optional: An iterable of torch.Tensors or dicts.</dt><dd><p>Specifies what Tensors should be optimized.</p>
</dd>
</dl>
<p>training_data: Optional: Dataset of type torch.utils.data.Dataset</p>
<dl class="simple">
<dt>lr_scheduler: Optional: Learning Rate Scheduler Object or a Callable that takes an Optimizer and returns a Scheduler object.</dt><dd><p>The scheduler object should define a get_lr(), step(), state_dict(), and load_state_dict() methods</p>
</dd>
<dt>mpu: Optional: A model parallelism unit object that implements</dt><dd><p>get_{model,data}_parallel_{rank,group,world_size}()</p>
</dd>
<dt>dist_init_required: Optional: None will auto-initialize torch distributed if needed,</dt><dd><p>otherwise the user can force it to be initialized or not via boolean.</p>
</dd>
<dt>collate_fn: Optional: Merges a list of samples to form a</dt><dd><p>mini-batch of Tensor(s).  Used when using batched loading from a
map-style dataset.</p>
</dd>
<dt>config: Optional: Instead of requiring args.deepspeed_config you can pass your deepspeed config</dt><dd><p>as an argument instead, as a path or a dictionary.</p>
</dd>
</dl>
<p>config_params: Optional: Same as <cite>config</cite>, kept for backwards compatibility.</p>
</dd>
<dt>Returns:</dt><dd><p>A tuple of <code class="docutils literal notranslate"><span class="pre">engine</span></code>, <code class="docutils literal notranslate"><span class="pre">optimizer</span></code>, <code class="docutils literal notranslate"><span class="pre">training_dataloader</span></code>, <code class="docutils literal notranslate"><span class="pre">lr_scheduler</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">engine</span></code>: DeepSpeed runtime engine which wraps the client model for distributed training.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimizer</span></code>: Wrapped optimizer if a user defined <code class="docutils literal notranslate"><span class="pre">optimizer</span></code> is supplied, or if
optimizer is specified in json config else <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">training_dataloader</span></code>: DeepSpeed dataloader if <code class="docutils literal notranslate"><span class="pre">training_data</span></code> was supplied,
otherwise <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr_scheduler</span></code>: Wrapped lr scheduler if user <code class="docutils literal notranslate"><span class="pre">lr_scheduler</span></code> is passed, or
if <code class="docutils literal notranslate"><span class="pre">lr_scheduler</span></code> specified in JSON configuration. Otherwise <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.PPEngine.is_even">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.PPEngine.</span></span><span class="sig-name descname"><span class="pre">is_even</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">number</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.PPEngine.is_even" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.arg_utils">
<span id="sfm-utils-arg-utils-module"></span><h2>sfm.utils.arg_utils module<a class="headerlink" href="#module-sfm.utils.arg_utils" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.ExtraArgsProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">ExtraArgsProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">configs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.ExtraArgsProvider" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.add_dataclass_to_parser">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">add_dataclass_to_parser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">configs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parser</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ArgumentParser</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.add_dataclass_to_parser" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.argument_exists">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">argument_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parser</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.argument_exists" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.from_args">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">from_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.from_args" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.is_collection">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">is_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sfm.utils.arg_utils.is_collection" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.is_enum_type">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">is_enum_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sfm.utils.arg_utils.is_enum_type" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.make_enum_praser">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">make_enum_praser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enum</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Enum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.make_enum_praser" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.arg_utils.unwarp_optional">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.arg_utils.</span></span><span class="sig-name descname"><span class="pre">unwarp_optional</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.arg_utils.unwarp_optional" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.barrier">
<span id="sfm-utils-barrier-module"></span><h2>sfm.utils.barrier module<a class="headerlink" href="#module-sfm.utils.barrier" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.barrier.check">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.barrier.</span></span><span class="sig-name descname"><span class="pre">check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_workers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rank</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.barrier.check" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.cli_utils">
<span id="sfm-utils-cli-utils-module"></span><h2>sfm.utils.cli_utils module<a class="headerlink" href="#module-sfm.utils.cli_utils" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.cli_utils.cli">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.cli_utils.</span></span><span class="sig-name descname"><span class="pre">cli</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">cfg_classes_and_funcs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.cli_utils.cli" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.copilot_module">
<span id="sfm-utils-copilot-module-module"></span><h2>sfm.utils.copilot_module module<a class="headerlink" href="#module-sfm.utils.copilot_module" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.CopilotModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.copilot_module.</span></span><span class="sig-name descname"><span class="pre">CopilotModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_stages=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topology=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_fn=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_layers=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_fn=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_seed=1234</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_method='parameters'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part_list=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_checkpoint_interval=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_checkpoint_func=&lt;function</span> <span class="pre">checkpoint&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpointable_layers=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freeze_layer=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.copilot_module.CopilotModule" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.mypp_module.PipelineModule" title="sfm.utils.mypp_module.PipelineModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">PipelineModule</span></code></a></p>
<p>Modules to be parallelized with pipeline parallelism.</p>
<p>The key constraint that enables pipeline parallelism is the
representation of the forward pass as a sequence of layers
and the enforcement of a simple interface between them. The
forward pass is implicitly defined by the module <code class="docutils literal notranslate"><span class="pre">layers</span></code>. The key
assumption is that the output of each layer can be directly fed as
input to the next, like a <code class="docutils literal notranslate"><span class="pre">torch.nn.Sequence</span></code>. The forward pass is
implicitly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pipeline parallelism is not compatible with ZeRO-2 and ZeRO-3.</p>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>layers (Iterable): A sequence of layers defining pipeline structure. Can be a <code class="docutils literal notranslate"><span class="pre">torch.nn.Sequential</span></code> module.
num_stages (int, optional): The degree of pipeline parallelism. If not specified, <code class="docutils literal notranslate"><span class="pre">topology</span></code> must be provided.
topology (<code class="docutils literal notranslate"><span class="pre">deepspeed.runtime.pipe.ProcessTopology</span></code>, optional): Defines the axes of parallelism axes for training. Must be provided if <code class="docutils literal notranslate"><span class="pre">num_stages</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.
loss_fn (callable, optional): Loss is computed <code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">=</span> <span class="pre">loss_fn(outputs,</span> <span class="pre">label)</span></code>
seed_layers(bool, optional): Use a different seed for each layer. Defaults to False.
seed_fn(type, optional): The custom seed generating function. Defaults to random seed generator.
base_seed (int, optional): The starting seed. Defaults to 1234.
partition_method (str, optional): The method upon which the layers are partitioned. Defaults to ‘parameters’.
activation_checkpoint_interval (int, optional): The granularity activation checkpointing in terms of number of layers. 0 disables activation checkpointing.
activation_checkpoint_func (callable, optional): The function to use for activation checkpointing. Defaults to <code class="docutils literal notranslate"><span class="pre">deepspeed.checkpointing.checkpoint</span></code>.
checkpointable_layers(list, optional): Checkpointable layers may not be checkpointed. Defaults to None which does not additional filtering.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.CopilotModule.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forward_input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.copilot_module.CopilotModule.forward" title="Link to this definition"></a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.CopilotModule.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sfm.utils.copilot_module.CopilotModule.training" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.LayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.copilot_module.</span></span><span class="sig-name descname"><span class="pre">LayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.copilot_module.LayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Building block for specifying pipeline-parallel modules.</p>
<p>LayerSpec stores the type information and parameters for each stage in a
PipelineModule. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nn</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_hidden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dim</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>becomes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer_specs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LayerSpec</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">LayerSpec</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_hidden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dim</span><span class="p">)]</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.LayerSpec.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.copilot_module.LayerSpec.build" title="Link to this definition"></a></dt>
<dd><p>Build the stored specification.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.PipelineError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.copilot_module.</span></span><span class="sig-name descname"><span class="pre">PipelineError</span></span><a class="headerlink" href="#sfm.utils.copilot_module.PipelineError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Errors related to the use of deepspeed.PipelineModule</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.copilot_module.TiedLayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.copilot_module.</span></span><span class="sig-name descname"><span class="pre">TiedLayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forward_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tied_weight_attr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weight'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.copilot_module.TiedLayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.copilot_module.LayerSpec" title="sfm.utils.copilot_module.LayerSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">LayerSpec</span></code></a></p>
</dd></dl>

</section>
<section id="module-sfm.utils.defaultdsconfig">
<span id="sfm-utils-defaultdsconfig-module"></span><h2>sfm.utils.defaultdsconfig module<a class="headerlink" href="#module-sfm.utils.defaultdsconfig" title="Link to this heading"></a></h2>
</section>
<section id="module-sfm.utils.dist_utils">
<span id="sfm-utils-dist-utils-module"></span><h2>sfm.utils.dist_utils module<a class="headerlink" href="#module-sfm.utils.dist_utils" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.dist_utils.is_master_node">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.dist_utils.</span></span><span class="sig-name descname"><span class="pre">is_master_node</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.dist_utils.is_master_node" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.env_init">
<span id="sfm-utils-env-init-module"></span><h2>sfm.utils.env_init module<a class="headerlink" href="#module-sfm.utils.env_init" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.env_init.set_env">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.env_init.</span></span><span class="sig-name descname"><span class="pre">set_env</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.env_init.set_env" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.get_paranum">
<span id="sfm-utils-get-paranum-module"></span><h2>sfm.utils.get_paranum module<a class="headerlink" href="#module-sfm.utils.get_paranum" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.get_paranum.count_paranum">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.get_paranum.</span></span><span class="sig-name descname"><span class="pre">count_paranum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.get_paranum.count_paranum" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.jload">
<span id="sfm-utils-jload-module"></span><h2>sfm.utils.jload module<a class="headerlink" href="#module-sfm.utils.jload" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.jload.jdump">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.jload.</span></span><span class="sig-name descname"><span class="pre">jdump</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode='w'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent=4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default=&lt;class</span> <span class="pre">'str'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.jload.jdump" title="Link to this definition"></a></dt>
<dd><p>Dump a str or dictionary to a file in json format.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>obj: An object to be written.
f: A string path to the location on disk.
mode: Mode for opening the file.
indent: Indent for storing json dictionaries.
default: A function to handle non-serializable entries; defaults to <cite>str</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.jload.jload">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.jload.</span></span><span class="sig-name descname"><span class="pre">jload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'r'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.jload.jload" title="Link to this definition"></a></dt>
<dd><p>Load a .json file into a dictionary.</p>
</dd></dl>

</section>
<section id="module-sfm.utils.move_to_device">
<span id="sfm-utils-move-to-device-module"></span><h2>sfm.utils.move_to_device module<a class="headerlink" href="#module-sfm.utils.move_to_device" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.OutputMixIn">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.move_to_device.</span></span><span class="sig-name descname"><span class="pre">OutputMixIn</span></span><a class="headerlink" href="#sfm.utils.move_to_device.OutputMixIn" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>MixIn to give namedtuple some access capabilities of a dictionary</p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.OutputMixIn.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.move_to_device.OutputMixIn.get" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.OutputMixIn.iget">
<span class="sig-name descname"><span class="pre">iget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.move_to_device.OutputMixIn.iget" title="Link to this definition"></a></dt>
<dd><p>Select item(s) row-wise.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>idx ([int, slice]): item to select</p>
</dd>
<dt>Returns:</dt><dd><p>Output of single item.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.OutputMixIn.items">
<span class="sig-name descname"><span class="pre">items</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.move_to_device.OutputMixIn.items" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.OutputMixIn.keys">
<span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.move_to_device.OutputMixIn.keys" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.move_to_device.move_to_device">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.move_to_device.</span></span><span class="sig-name descname"><span class="pre">move_to_device</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DeviceObjType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_blocking</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sfm.utils.move_to_device.move_to_device" title="Link to this definition"></a></dt>
<dd><p>Move object to device.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>x (dictionary of list of tensors): object (e.g. dictionary) of tensors to move to device
device (Union[str, torch.DeviceObjType]): device, e.g. “cpu”</p>
</dd>
<dt>Returns:</dt><dd><p>x on targeted device</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-sfm.utils.myPipelineParallelGrid">
<span id="sfm-utils-mypipelineparallelgrid-module"></span><h2>sfm.utils.myPipelineParallelGrid module<a class="headerlink" href="#module-sfm.utils.myPipelineParallelGrid" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.PipeDataParallelTopology">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.myPipelineParallelGrid.</span></span><span class="sig-name descname"><span class="pre">PipeDataParallelTopology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_pp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.PipeDataParallelTopology" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology" title="sfm.utils.myPipelineParallelGrid.ProcessTopology"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessTopology</span></code></a></p>
<p>A topology specialization for hybrid data and pipeline parallelism.</p>
<p>Uses data parallelism on the last dimension to encourage gradient
reductions to use high-bandwidth intra-node links and lower-volume
pipeline communications to use low-bandwidth inter-node links.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.PipeModelDataParallelTopology">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.myPipelineParallelGrid.</span></span><span class="sig-name descname"><span class="pre">PipeModelDataParallelTopology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_pp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_mp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.PipeModelDataParallelTopology" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology" title="sfm.utils.myPipelineParallelGrid.ProcessTopology"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessTopology</span></code></a></p>
<p>A topology for hybrid pipeline, model, and data parallelism.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.myPipelineParallelGrid.</span></span><span class="sig-name descname"><span class="pre">ProcessTopology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dims</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Manages the mapping of n-dimensional Cartesian coordinates to linear
indices. This mapping is used to map the rank of processes to the grid
for various forms of parallelism.</p>
<p>Each axis of the tensor is accessed by its name. The provided ordering
of the axes defines the layout of the topology. ProcessTopology uses a “row-major”
layout of the tensor axes, and so axes=[‘x’, ‘y’] would map coordinates (x,y) and
(x,y+1) to adjacent linear indices. If instead axes=[‘y’, ‘x’] was used, coordinates
(x,y) and (x+1,y) would be adjacent.</p>
<p>Some methods return ProcessCoord namedtuples.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.filter_match">
<span class="sig-name descname"><span class="pre">filter_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">filter_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.filter_match" title="Link to this definition"></a></dt>
<dd><p>Return the list of ranks whose coordinates match the provided criteria.</p>
<dl>
<dt>Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">ProcessTopology</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">filter_match</span><span class="p">(</span><span class="n">pipe</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">filter_match</span><span class="p">(</span><span class="n">pipe</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="go">[ProcessCoord(pipe=0, data=1, model=0), ProcessCoord(pipe=0, data=1, model=1)]</span>
</pre></div>
</div>
</dd>
<dt>Arguments:</dt><dd><p><a href="#id5"><span class="problematic" id="id6">**</span></a>filter_kwargs (dict): criteria used to select coordinates.</p>
</dd>
<dt>Returns:</dt><dd><p>The list of ranks whose coordinates match filter_kwargs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_comm_lists">
<span class="sig-name descname"><span class="pre">get_axis_comm_lists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_comm_lists" title="Link to this definition"></a></dt>
<dd><p>Construct lists suitable for a communicator group along axis <code class="docutils literal notranslate"><span class="pre">axis</span></code>.</p>
<dl>
<dt>Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">topo</span> <span class="o">=</span> <span class="n">Topo</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topo</span><span class="o">.</span><span class="n">get_axis_comm_lists</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">)</span>
<span class="go">[</span>
<span class="go">    [0, 4], # data=0, model=0</span>
<span class="go">    [1, 5], # data=0, model=1</span>
<span class="go">    [2, 6], # data=1, model=0</span>
<span class="go">    [3, 7], # data=1, model=1</span>
<span class="go">]</span>
</pre></div>
</div>
</dd>
<dt>Returns:</dt><dd><p>A list of lists whose coordinates match in all axes <em>except</em> <code class="docutils literal notranslate"><span class="pre">axis</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_list">
<span class="sig-name descname"><span class="pre">get_axis_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_list" title="Link to this definition"></a></dt>
<dd><p>Returns the list of global ranks whose coordinate in an axis is idx.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">ProcessTopology</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">get_axis_list</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">[0, 1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">get_axis_list</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">[0, 3]</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_names">
<span class="sig-name descname"><span class="pre">get_axis_names</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_axis_names" title="Link to this definition"></a></dt>
<dd><p>Return a list of the axis names in the ordering of the topology.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_coord">
<span class="sig-name descname"><span class="pre">get_coord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_coord" title="Link to this definition"></a></dt>
<dd><p>Return the coordinate owned by a process rank.</p>
<p>The axes of the returned namedtuple can be directly accessed as members. For
example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">ProcessTopology</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coord</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coord</span><span class="o">.</span><span class="n">x</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coord</span><span class="o">.</span><span class="n">y</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_dim">
<span class="sig-name descname"><span class="pre">get_dim</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_dim" title="Link to this definition"></a></dt>
<dd><p>Return the number of processes along the given axis.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">ProcessTopology</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">get_dim</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_rank">
<span class="sig-name descname"><span class="pre">get_rank</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">coord_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_rank" title="Link to this definition"></a></dt>
<dd><p>Return the global rank of a process via its coordinates.</p>
<p>Coordinates are specified as kwargs. For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">ProcessTopology</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">get_rank</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.get_rank_repr">
<span class="sig-name descname"><span class="pre">get_rank_repr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omit_axes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['data',</span> <span class="pre">'pipe']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_sep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'_'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_sep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'-'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.get_rank_repr" title="Link to this definition"></a></dt>
<dd><p>Return a string representation of a rank.</p>
<p>This method is primarily used for checkpointing model data.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">topo</span> <span class="o">=</span> <span class="n">Topo</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topo</span><span class="o">.</span><span class="n">get_rank_repr</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&#39;a_01-b_01&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topo</span><span class="o">.</span><span class="n">get_rank_repr</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">omit_axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="go">&#39;b_01&#39;</span>
</pre></div>
</div>
</dd>
<dt>Args:</dt><dd><p>rank (int): A rank in the topology.
omit_axes (list, optional): Axes that should not be in the representation. Defaults to [‘data’, ‘pipe’].
inner_sep (str, optional): [description]. Defaults to ‘_’.
outer_sep (str, optional): [description]. Defaults to ‘-‘.</p>
</dd>
<dt>Returns:</dt><dd><p>str: A string representation of the coordinate owned by <code class="docutils literal notranslate"><span class="pre">rank</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.ProcessTopology.world_size">
<span class="sig-name descname"><span class="pre">world_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.ProcessTopology.world_size" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.myPipelineParallelGrid.</span></span><span class="sig-name descname"><span class="pre">myPipelineParallelGrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Implements a grid object that stores the data parallel ranks
corresponding to each of the model parallel stages</p>
<p>The grid object organizes the processes in a distributed pytorch job
into a 2D grid, of stage_id and data_parallel_id.</p>
<p>self.stage_id and self.data_parallel_id stores the stage id
and the data parallel id of current process.</p>
<p>self.dp_group groups the processes by stage_id.
self.dp_group[i], is a list containing all process ranks whose
stage_id is i.</p>
<p>self.p2p_groups stores a list of tuple, where each tuple
stores process ranks of adjacent stages for a given data_parallel_id.
For example if num_stage is 5 then a tuple [7,8] represents stages [3, 4],
with data_parallel id = 1. A stage wrap around will appear as non-adjacent ranks,
for example tuple [4,0] with representing wrap-around stage 4 and 0, for
data_parallel_id = 0, or similarly [9,5] represents wrapped around stages [4,0]
for data_parallel_id = 1.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_group">
<span class="sig-name descname"><span class="pre">get_data_parallel_group</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_group" title="Link to this definition"></a></dt>
<dd><p>The group of ranks within the same stage of all pipelines.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_id">
<span class="sig-name descname"><span class="pre">get_data_parallel_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_rank">
<span class="sig-name descname"><span class="pre">get_data_parallel_rank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_rank" title="Link to this definition"></a></dt>
<dd><p>Which pipeline this rank resides in.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_world_size">
<span class="sig-name descname"><span class="pre">get_data_parallel_world_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_data_parallel_world_size" title="Link to this definition"></a></dt>
<dd><p>The number of pipelines.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_global_rank">
<span class="sig-name descname"><span class="pre">get_global_rank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_global_rank" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_group">
<span class="sig-name descname"><span class="pre">get_model_parallel_group</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_group" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_rank">
<span class="sig-name descname"><span class="pre">get_model_parallel_rank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_rank" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_world_size">
<span class="sig-name descname"><span class="pre">get_model_parallel_world_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_model_parallel_world_size" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_group">
<span class="sig-name descname"><span class="pre">get_pipe_parallel_group</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_group" title="Link to this definition"></a></dt>
<dd><p>The group of ranks within the same pipeline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_rank">
<span class="sig-name descname"><span class="pre">get_pipe_parallel_rank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_rank" title="Link to this definition"></a></dt>
<dd><p>The stage of the pipeline this rank resides in.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_world_size">
<span class="sig-name descname"><span class="pre">get_pipe_parallel_world_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_pipe_parallel_world_size" title="Link to this definition"></a></dt>
<dd><p>The number of stages in the pipeline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_group">
<span class="sig-name descname"><span class="pre">get_slice_parallel_group</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_group" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_rank">
<span class="sig-name descname"><span class="pre">get_slice_parallel_rank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_rank" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_world_size">
<span class="sig-name descname"><span class="pre">get_slice_parallel_world_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_slice_parallel_world_size" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_stage_id">
<span class="sig-name descname"><span class="pre">get_stage_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.get_stage_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.stage_to_global">
<span class="sig-name descname"><span class="pre">stage_to_global</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_id</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.stage_to_global" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.topology">
<span class="sig-name descname"><span class="pre">topology</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.myPipelineParallelGrid.myPipelineParallelGrid.topology" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-sfm.utils.mypp_module">
<span id="sfm-utils-mypp-module-module"></span><h2>sfm.utils.mypp_module module<a class="headerlink" href="#module-sfm.utils.mypp_module" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.LayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.mypp_module.</span></span><span class="sig-name descname"><span class="pre">LayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.LayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Building block for specifying pipeline-parallel modules.</p>
<p>LayerSpec stores the type information and parameters for each stage in a
PipelineModule. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nn</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_hidden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dim</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>becomes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer_specs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LayerSpec</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">LayerSpec</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_hidden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dim</span><span class="p">)]</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.LayerSpec.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.LayerSpec.build" title="Link to this definition"></a></dt>
<dd><p>Build the stored specification.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.mypp_module.</span></span><span class="sig-name descname"><span class="pre">PipelineError</span></span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Errors related to the use of deepspeed.PipelineModule</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.mypp_module.</span></span><span class="sig-name descname"><span class="pre">PipelineModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_stages=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topology=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_fn=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_layers=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_fn=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_seed=1234</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_method='parameters'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part_list=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_checkpoint_interval=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_checkpoint_func=&lt;function</span> <span class="pre">checkpoint&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpointable_layers=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_log_dict={}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></p>
<p>Modules to be parallelized with pipeline parallelism.</p>
<p>The key constraint that enables pipeline parallelism is the
representation of the forward pass as a sequence of layers
and the enforcement of a simple interface between them. The
forward pass is implicitly defined by the module <code class="docutils literal notranslate"><span class="pre">layers</span></code>. The key
assumption is that the output of each layer can be directly fed as
input to the next, like a <code class="docutils literal notranslate"><span class="pre">torch.nn.Sequence</span></code>. The forward pass is
implicitly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pipeline parallelism is not compatible with ZeRO-2 and ZeRO-3.</p>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>layers (Iterable): A sequence of layers defining pipeline structure. Can be a <code class="docutils literal notranslate"><span class="pre">torch.nn.Sequential</span></code> module.
num_stages (int, optional): The degree of pipeline parallelism. If not specified, <code class="docutils literal notranslate"><span class="pre">topology</span></code> must be provided.
topology (<code class="docutils literal notranslate"><span class="pre">deepspeed.runtime.pipe.ProcessTopology</span></code>, optional): Defines the axes of parallelism axes for training. Must be provided if <code class="docutils literal notranslate"><span class="pre">num_stages</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.
loss_fn (callable, optional): Loss is computed <code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">=</span> <span class="pre">loss_fn(outputs,</span> <span class="pre">label)</span></code>
seed_layers(bool, optional): Use a different seed for each layer. Defaults to False.
seed_fn(type, optional): The custom seed generating function. Defaults to random seed generator.
base_seed (int, optional): The starting seed. Defaults to 1234.
partition_method (str, optional): The method upon which the layers are partitioned. Defaults to ‘parameters’.
activation_checkpoint_interval (int, optional): The granularity activation checkpointing in terms of number of layers. 0 disables activation checkpointing.
activation_checkpoint_func (callable, optional): The function to use for activation checkpointing. Defaults to <code class="docutils literal notranslate"><span class="pre">deepspeed.checkpointing.checkpoint</span></code>.
checkpointable_layers(list, optional): Checkpointable layers may not be checkpointed. Defaults to None which does not additional filtering.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.allreduce_tied_weight_gradients">
<span class="sig-name descname"><span class="pre">allreduce_tied_weight_gradients</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.allreduce_tied_weight_gradients" title="Link to this definition"></a></dt>
<dd><p>All reduce the gradients of the tied weights between tied stages</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.ckpt_layer_path">
<span class="sig-name descname"><span class="pre">ckpt_layer_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ckpt_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_layer_idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.ckpt_layer_path" title="Link to this definition"></a></dt>
<dd><p>Customize a prefix for a specific pipeline module layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.ckpt_layer_path_list">
<span class="sig-name descname"><span class="pre">ckpt_layer_path_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ckpt_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_layer_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_ckpt_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.ckpt_layer_path_list" title="Link to this definition"></a></dt>
<dd><p>Get all ckpt file list for a specific pipeline module layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.ckpt_prefix">
<span class="sig-name descname"><span class="pre">ckpt_prefix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoints_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.ckpt_prefix" title="Link to this definition"></a></dt>
<dd><p>Build a prefix for all checkpoint files written by this module.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.fast_load_state_dir">
<span class="sig-name descname"><span class="pre">fast_load_state_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint_engine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_ckpt_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mfm_lora</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.fast_load_state_dir" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forward_input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.forward" title="Link to this definition"></a></dt>
<dd><p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.get_tied_weights_and_groups">
<span class="sig-name descname"><span class="pre">get_tied_weights_and_groups</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.get_tied_weights_and_groups" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.load_state_dir">
<span class="sig-name descname"><span class="pre">load_state_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">load_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpoint_engine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.load_state_dir" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.mpu">
<span class="sig-name descname"><span class="pre">mpu</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.mpu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.num_pipeline_stages">
<span class="sig-name descname"><span class="pre">num_pipeline_stages</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.num_pipeline_stages" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.partitions">
<span class="sig-name descname"><span class="pre">partitions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.partitions" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.save_state_dict">
<span class="sig-name descname"><span class="pre">save_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpoint_engine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.save_state_dict" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.set_checkpoint_interval">
<span class="sig-name descname"><span class="pre">set_checkpoint_interval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.set_checkpoint_interval" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.stage_owner">
<span class="sig-name descname"><span class="pre">stage_owner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.stage_owner" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.topology">
<span class="sig-name descname"><span class="pre">topology</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.topology" title="Link to this definition"></a></dt>
<dd><p>ProcessTopology object to query process mappings.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.PipelineModule.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sfm.utils.mypp_module.PipelineModule.training" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.TiedLayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.mypp_module.</span></span><span class="sig-name descname"><span class="pre">TiedLayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forward_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tied_weight_attr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weight'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.TiedLayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.mypp_module.LayerSpec" title="sfm.utils.mypp_module.LayerSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">LayerSpec</span></code></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.mypp_module.partition_by_layers">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.mypp_module.</span></span><span class="sig-name descname"><span class="pre">partition_by_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary_weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_total_layers</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.mypp_module.partition_by_layers" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.peft">
<span id="sfm-utils-peft-module"></span><h2>sfm.utils.peft module<a class="headerlink" href="#module-sfm.utils.peft" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.peft.create_peft_model">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.peft.</span></span><span class="sig-name descname"><span class="pre">create_peft_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.peft.create_peft_model" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.pipelinemode">
<span id="sfm-utils-pipelinemode-module"></span><h2>sfm.utils.pipelinemode module<a class="headerlink" href="#module-sfm.utils.pipelinemode" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.LlamaDecoderLayerTest">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">LlamaDecoderLayerTest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LlamaConfig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.LlamaDecoderLayerTest" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LlamaDecoderLayer</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.LlamaDecoderLayerTest.dict_forward">
<span class="sig-name descname"><span class="pre">dict_forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batched_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">FloatTensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sfm.utils.pipelinemode.LlamaDecoderLayerTest.dict_forward" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Args:</dt><dd><p>hidden_states (<cite>torch.FloatTensor</cite>): input to the layer of shape <cite>(batch, seq_len, embed_dim)</cite>
attention_mask (<cite>torch.FloatTensor</cite>, <em>optional</em>): attention mask of size</p>
<blockquote>
<div><p><cite>(batch, 1, tgt_len, src_len)</cite> where padding elements are indicated by very large negative values.</p>
</div></blockquote>
<dl class="simple">
<dt>output_attentions (<cite>bool</cite>, <em>optional</em>):</dt><dd><p>Whether or not to return the attentions tensors of all attention layers. See <cite>attentions</cite> under
returned tensors for more detail.</p>
</dd>
<dt>use_cache (<cite>bool</cite>, <em>optional</em>):</dt><dd><p>If set to <cite>True</cite>, <cite>past_key_values</cite> key value states are returned and can be used to speed up decoding
(see <cite>past_key_values</cite>).</p>
</dd>
</dl>
<p>past_key_value (<cite>Tuple(torch.FloatTensor)</cite>, <em>optional</em>): cached past key and value projection states</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.LlamaDecoderLayerTest.tensor_forward">
<span class="sig-name descname"><span class="pre">tensor_forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hidden_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attention_mask_bool</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LongTensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">past_key_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_attentions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_cache</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">FloatTensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sfm.utils.pipelinemode.LlamaDecoderLayerTest.tensor_forward" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Args:</dt><dd><p>hidden_states (<cite>torch.FloatTensor</cite>): input to the layer of shape <cite>(batch, seq_len, embed_dim)</cite>
attention_mask (<cite>torch.FloatTensor</cite>, <em>optional</em>): attention mask of size</p>
<blockquote>
<div><p><cite>(batch, 1, tgt_len, src_len)</cite> where padding elements are indicated by very large negative values.</p>
</div></blockquote>
<dl class="simple">
<dt>output_attentions (<cite>bool</cite>, <em>optional</em>):</dt><dd><p>Whether or not to return the attentions tensors of all attention layers. See <cite>attentions</cite> under
returned tensors for more detail.</p>
</dd>
<dt>use_cache (<cite>bool</cite>, <em>optional</em>):</dt><dd><p>If set to <cite>True</cite>, <cite>past_key_values</cite> key value states are returned and can be used to speed up decoding
(see <cite>past_key_values</cite>).</p>
</dd>
</dl>
<p>past_key_value (<cite>Tuple(torch.FloatTensor)</cite>, <em>optional</em>): cached past key and value projection states</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.LlamaDecoderLayerTest.training">
<span class="sig-name descname"><span class="pre">training</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sfm.utils.pipelinemode.LlamaDecoderLayerTest.training" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.check_grad_requirements">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">check_grad_requirements</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_or_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.check_grad_requirements" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.convert2list">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">convert2list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.convert2list" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.pipemode">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">pipemode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forward_func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.pipemode" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.pipemodegradcheck">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">pipemodegradcheck</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forward_func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.pipemodegradcheck" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pipelinemode.tuple2input">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pipelinemode.</span></span><span class="sig-name descname"><span class="pre">tuple2input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pipelinemode.tuple2input" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.pretrained_layer_spec">
<span id="sfm-utils-pretrained-layer-spec-module"></span><h2>sfm.utils.pretrained_layer_spec module<a class="headerlink" href="#module-sfm.utils.pretrained_layer_spec" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.pretrained_layer_spec.</span></span><span class="sig-name descname"><span class="pre">PretrainedLayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LayerSpec</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.build" title="Link to this definition"></a></dt>
<dd><p>Build the stored specification.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.create_peft_model">
<span class="sig-name descname"><span class="pre">create_peft_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lora</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.create_peft_model" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.load_pretrained">
<span class="sig-name descname"><span class="pre">load_pretrained</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.load_pretrained" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.partition_load_pretrained">
<span class="sig-name descname"><span class="pre">partition_load_pretrained</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.partition_load_pretrained" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.resize_token_embeddings">
<span class="sig-name descname"><span class="pre">resize_token_embeddings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoints_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec.resize_token_embeddings" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.TiedPretrainedLayerSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sfm.utils.pretrained_layer_spec.</span></span><span class="sig-name descname"><span class="pre">TiedPretrainedLayerSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typename</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forward_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tied_weight_attr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weight'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">module_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.TiedPretrainedLayerSpec" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#sfm.utils.pretrained_layer_spec.PretrainedLayerSpec" title="sfm.utils.pretrained_layer_spec.PretrainedLayerSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">PretrainedLayerSpec</span></code></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sfm.utils.pretrained_layer_spec.load_ckp_tied_modules">
<span class="sig-prename descclassname"><span class="pre">sfm.utils.pretrained_layer_spec.</span></span><span class="sig-name descname"><span class="pre">load_ckp_tied_modules</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_num_tokens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sfm.utils.pretrained_layer_spec.load_ckp_tied_modules" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-sfm.utils.science_tokens">
<span id="sfm-utils-science-tokens-module"></span><h2>sfm.utils.science_tokens module<a class="headerlink" href="#module-sfm.utils.science_tokens" title="Link to this heading"></a></h2>
</section>
<section id="module-sfm.utils">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-sfm.utils" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sfm.tasks.tamgent.html" class="btn btn-neutral float-left" title="sfm.tasks.tamgent package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sfm.utils.optim.html" class="btn btn-neutral float-right" title="sfm.utils.optim package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, MSR A4S team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
